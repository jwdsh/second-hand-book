# 二手书估价系统

一个基于 FastAPI + Vue 3 的智能二手书估价系统，支持ISBN识别、当当网价格获取和AI品相分析。

## ✨ 功能特性

- � **智能识别**：支持ISBN手动输入或图片OCR自动识别
- 💰 **当当网价格**：实时获取当当网官方图书价格
- 🔍 **AI品相分析**：基于百度千帆API的智能图书品相评估
- 📊 **历史记录**：本地存储评估历史，方便追踪
- 🎨 **现代UI**：基于Element Plus的美观响应式界面
- ⚡ **两步流程**：图书评估 → 评估结果，操作简单高效
一个基于 FastAPI + Vue 3 的智能二手书估价系统，支持ISBN识别、多平台价格对比和AI品相分析。

## ✨ 功能特性

- � **智能识别**：支持ISBN手动输入或图片OCR自动识别
- 💰 **价格对比**：实时获取当当网图书价格
- 🔍 **AI品相分析**：基于百度千帆API的智能图书品相评估
- 📊 **历史记录**：本地存储评估历史，方便追踪
- 🎨 **现代UI**：基于Element Plus的美观响应式界面

## 🏗️ 项目架构

```
second-hand-book/
├── backend/                    # FastAPI后端服务
│   ├── main.py                # 主应用入口
│   ├── condition/             # 品相分析模块
│   │   └── analyzer.py        # AI品相评估
│   ├── crawler/               # 价格爬虫模块
│   │   └── price_crawler.py   # 当当网价格获取
│   ├── database/              # 数据库管理
│   │   └── manager.py         # SQLite数据库操作
│   ├── ocr/                   # OCR识别模块
│   │   └── isbn_reader.py     # ISBN识别
│   └── pricing/               # 定价策略
│       └── strategy.py        # 价格计算算法
├── frontend/  # Vue 3前端应用
│   ├── src/
│   │   ├── views/             # 页面组件
│   │   │   ├── OcrView.vue    # ISBN识别与评估页面
│   │   │   ├── FinalPriceView.vue # 最终结果页面
│   │   │   └── HistoryView.vue    # 历史记录页面
│   │   ├── components/        # 公共组件
│   │   ├── router/            # Vue Router配置
│   │   └── config/            # API配置
│   └── package.json
└── README.md
```

## 🚀 快速开始

### 环境要求

- Python 3.8+
- Node.js 16+
- npm 或 yarn

### 后端启动

1. **进入后端目录**
```bash
cd backend
```

2. **安装Python依赖**
```bash
pip install fastapi uvicorn python-multipart requests python-dotenv
```

3. **启动后端服务**
```bash
uvicorn main:app --reload
```

✅ 后端服务将在 http://localhost:8000 启动

### 前端启动

1. **进入前端目录**
```bash
cd second-hand-book-frontend
```

2. **安装依赖**
```bash
npm install
```

3. **启动开发服务器**
```bash
npm run dev
```

✅ 前端应用将在 http://localhost:5173 启动

### 🌐 访问应用

打开浏览器访问：**http://localhost:5173**

## 📝 使用流程

### 1️⃣ 图书评估（一步到位）
- 上传书籍封面图片（自动OCR识别ISBN）
- 或手动输入ISBN号码
- 可选：上传书本实物图片进行品相分析
- 点击"开始评估"按钮

### 2️⃣ 查看评估结果
- 自动获取当当网官方价格
- 显示品相评分（如有图片分析）
- 计算最终建议价格
- 查看当当网参考价格详情
- 自动保存到本地历史记录

### 💡 数据来源说明
- **价格数据**：仅支持当当网价格获取
- **是否真实数据判断**：
  - 查看控制台调试信息，会显示是否为后端返回的真实数据
  - 后端返回的数据包含 `condition_score`、`final_price`、`prices` 等字段
  - 前端模拟数据通常具有固定的模拟值

## 🔧 API接口文档

### POST /evaluate
**图书综合评估接口（一步到位）**

**请求参数：**
- `file` (可选): 图书照片文件 (UploadFile)
- `isbn` (可选): ISBN号码 (string)

**响应示例：**
```json
{
  "isbn": "9787115123456",
  "prices": {
    "当当": 45.6
  },
  "condition_score": 0.85,
  "final_price": 39.2
}
```

**错误响应：**
```json
{
  "error": "未找到该ISBN的图书信息"
}
```

### GET /records?limit=10
**获取历史评估记录**

**响应示例：**
```json
[
  {
    "isbn": "9787115123456",
    "prices": {"当当": 45.6},
    "score": 0.85,
    "final_price": 39.2
  }
]
```

## 🎯 核心功能说明

### 一步评估流程
- 前端直接调用 `/evaluate` 接口
- 后端完成OCR识别、价格获取、品相分析、价格计算全流程
- 返回最终结果，前端直接显示

### 调试信息
- 前端控制台输出详细的调试信息
- 可以通过日志判断数据来源（后端真实数据 vs 前端模拟数据）
- 包含请求参数、响应状态、数据处理过程等信息

### 定价算法
```python
# 基础定价策略（仅当当网）
最终价格 = 当当网价格 × 品相评分
# 如果没有品相分析，使用默认评分0.9
```

### 品相评估
- 基于百度千帆大模型视觉能力
- 综合评估封面破损、页面污渍、整体老化程度
- 返回0-1之间的评分，影响最终定价
- 如果未上传品相图片，使用默认评分0.9

### 数据存储
- **后端**：SQLite数据库存储评估记录
- **前端**：浏览器sessionStorage存储用户历史（仅本地）

### 数据来源判断
开发者可通过以下方式判断数据来源：

1. **查看浏览器控制台**：
   ```
   📊 [OCR Debug] 后端返回完整数据: {...}
   📈 [Final Debug] 最终显示数据: {...}
   ```

2. **检查数据特征**：
   - 后端数据：包含真实的condition_score、prices等字段
   - 模拟数据：通常具有固定的测试值

3. **网络请求**：
   - 真实请求会在Network面板中显示对/evaluate的POST请求
   - 模拟数据不会产生网络请求

## 🛠️ 技术栈

| 类别 | 技术选型 | 说明 |
|------|---------|------|
| **后端框架** | FastAPI | 高性能异步Web框架 |
| **前端框架** | Vue 3 + TypeScript | 现代响应式前端 |
| **UI组件库** | Element Plus | 企业级Vue组件库 |
| **数据库** | SQLite | 轻量级关系数据库 |
| **AI服务** | 百度千帆API | 图像识别和品相分析 |
| **路由管理** | Vue Router | 前端路由解决方案 |
| **价格来源** | 当当网 | 目前仅支持当当网价格获取 |

## ⚙️ 配置说明

### 后端配置
- **端口**: 8000 (可在main.py中修改)
- **CORS**: 已配置允许所有来源访问
- **千帆API**: 需在 `condition/.env` 中配置 `QIANFAN_API_KEY`

### 前端配置
- **API地址**: 在 `src/config/api.ts` 中配置
- **开发端口**: 5173 (Vite默认)

## 📋 注意事项

1. **启动顺序**: 请先启动后端服务，再启动前端应用
2. **API密钥**: 品相分析功能需要有效的百度千帆API密钥
3. **网络要求**: 价格获取和AI分析需要网络连接
4. **浏览器兼容**: 建议使用Chrome、Firefox、Safari等现代浏览器
5. **价格来源**: 目前仅支持当当网价格，其他平台价格暂不支持
6. **调试模式**: 可通过浏览器控制台查看详细的调试信息和数据来源

## 🐛 故障排除

### 后端启动失败
```bash
# 检查依赖是否完整安装
pip install -r requirements.txt

# 检查端口是否被占用
netstat -ano | findstr :8000
```

### 前端编译错误
```bash
# 清除缓存重新安装
rm -rf node_modules package-lock.json
npm install
```

### API调用失败
- 检查后端服务是否正常运行
- 确认防火墙设置允许8000端口访问
- 验证API配置文件中的地址是否正确

## 📞 技术支持

如遇到问题，请检查：
1. 控制台错误信息和调试日志
2. 网络连接状态  
3. 服务启动日志
4. API密钥配置

### 常见问题
- **如何判断数据来源**：查看浏览器控制台的调试信息
- **价格显示异常**：确认后端服务正常且当当网可访问
- **品相分析失败**：检查千帆API密钥配置
- **历史记录丢失**：历史记录存储在浏览器本地，清除缓存会丢失
